# Agent Network â†’ Workflow ì „í™˜ ë¶„ì„

## 1. í˜„ì¬ Agent Network êµ¬ì¡°ì˜ í•œê³„ì 

### 1-1. ë¹„ê²°ì •ì (Non-deterministic) ë¼ìš°íŒ…

í˜„ì¬ Supervisor Agentê°€ **LLM ì¶”ë¡ ì— ì˜ì¡´**í•˜ì—¬ Workerë¥¼ ì„ íƒí•©ë‹ˆë‹¤. ë™ì¼í•œ ì§ˆë¬¸ì—ë„ ë¼ìš°íŒ… ê²°ê³¼ê°€ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```
"Confluenceì—ì„œ ìµœì‹  íšŒì˜ë¡ ì°¾ì•„ì¤˜"
  â†’ AtlassianAgent? GoogleSearchAgent? ë‘˜ ë‹¤?
```

Supervisorì˜ `instructions`ì— í‚¤ì›Œë“œ ê¸°ë°˜ ê·œì¹™ì„ ì‘ì„±í•´ë„, LLMì´ ì´ë¥¼ 100% ì¤€ìˆ˜í•œë‹¤ëŠ” ë³´ì¥ì´ ì—†ìŠµë‹ˆë‹¤.

### 1-2. ë¹„êµ¬ì¡°ì  ë°ì´í„° íë¦„

Agent ê°„ ë°ì´í„°ê°€ **ìì—°ì–´(natural language)**ë¡œ ì „ë‹¬ë©ë‹ˆë‹¤. Supervisorê°€ Workerì—ê²Œ í”„ë¡¬í”„íŠ¸ë¥¼ ë³´ë‚´ê³ , Workerê°€ í…ìŠ¤íŠ¸ë¡œ ì‘ë‹µí•˜ë©´, Supervisorê°€ ë‹¤ì‹œ í…ìŠ¤íŠ¸ë¥¼ í•´ì„í•©ë‹ˆë‹¤.

```
Supervisor â†’ (ìì—°ì–´ í”„ë¡¬í”„íŠ¸) â†’ Worker â†’ (ìì—°ì–´ ì‘ë‹µ) â†’ Supervisor
```

- ìŠ¤í‚¤ë§ˆ ê²€ì¦ ì—†ìŒ â†’ ë°ì´í„° ìœ ì‹¤/ì™œê³¡ ê°€ëŠ¥
- ì¤‘ê°„ ê²°ê³¼ë¬¼ì˜ íƒ€ì… ì•ˆì „ì„± ë¶€ì¬

### 1-3. ë³‘ë ¬ ì‹¤í–‰ ì œì–´ ë¶ˆê°€

í˜„ì¬ êµ¬ì¡°ì—ì„œ ë³µìˆ˜ Workerë¥¼ í˜¸ì¶œí•  ë•Œ, **ì‹¤í–‰ ìˆœì„œì™€ ë³‘ë ¬ì„±ì„ ì œì–´í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤**. Supervisorê°€ "ìˆœì°¨ì ìœ¼ë¡œ í˜¸ì¶œí• ì§€, ë™ì‹œì— í˜¸ì¶œí• ì§€"ë¥¼ LLMì´ ì•Œì•„ì„œ ê²°ì •í•©ë‹ˆë‹¤.

### 1-4. ì—ëŸ¬ ì²˜ë¦¬ì˜ ì•”ë¬µì„±

Worker Agentê°€ MCP í˜¸ì¶œì— ì‹¤íŒ¨í•˜ë©´, Supervisorì—ê²Œ ìì—°ì–´ë¡œ "ì‹¤íŒ¨í–ˆë‹¤"ê³  ì „ë‹¬ë©ë‹ˆë‹¤. êµ¬ì¡°í™”ëœ ì—ëŸ¬ í•¸ë“¤ë§(ì¬ì‹œë„, í´ë°±, íƒ€ì„ì•„ì›ƒ)ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.

### 1-5. í† í° ë¹„íš¨ìœ¨

| ì—­í•  | ëª¨ë¸ | ë¹„ìš© |
|------|------|------|
| Supervisor (ë¼ìš°íŒ…ë§Œ ìˆ˜í–‰) | Sonnet 4.5 | **ë†’ìŒ** |
| Workers (ì‹¤ì œ ì‘ì—…) | Haiku 4.5 | ë‚®ìŒ |

ë‹¨ìˆœ ë¼ìš°íŒ…ì— ê³ ì„±ëŠ¥ ëª¨ë¸ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ë¹„ìš© ë‚­ë¹„ì…ë‹ˆë‹¤.

### 1-6. ê´€ì¸¡ì„±(Observability) ë¶€ì¡±

Agent Networkì€ ë‚´ë¶€ì ìœ¼ë¡œ ì–´ë–¤ Workerê°€ í˜¸ì¶œë˜ì—ˆê³ , ê° ë‹¨ê³„ì—ì„œ ì–´ë–¤ ë°ì´í„°ê°€ ì˜¤ê°”ëŠ”ì§€ ì¶”ì í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤. WorkflowëŠ” **ê° Stepì˜ input/outputì´ ëª…ì‹œì ìœ¼ë¡œ ê¸°ë¡**ë©ë‹ˆë‹¤.

### 1-7. í™•ì¥ì„± ì œì•½

ìƒˆë¡œìš´ Workerë¥¼ ì¶”ê°€í•  ë•Œë§ˆë‹¤ Supervisorì˜ `instructions`ë¥¼ ìˆ˜ì •í•´ì•¼ í•˜ê³ , ë¼ìš°íŒ… ê·œì¹™ì´ í”„ë¡¬í”„íŠ¸ì— ë¬»í˜€ ê´€ë¦¬ê°€ ì–´ë ¤ì›Œì§‘ë‹ˆë‹¤.

---

## 2. ì œì•ˆí•˜ëŠ” Workflow ì•„í‚¤í…ì²˜

### í•µì‹¬ ì„¤ê³„ ì›ì¹™

| ì›ì¹™ | Agent Network (í˜„ì¬) | Workflow (ì œì•ˆ) |
|------|---------------------|----------------|
| ë¼ìš°íŒ… | LLM ì¶”ë¡  (ë¹„ê²°ì •ì ) | êµ¬ì¡°í™”ëœ ë¶„ë¥˜ + ë¶„ê¸° (ê²°ì •ì ) |
| ë°ì´í„° íë¦„ | ìì—°ì–´ | Zod ìŠ¤í‚¤ë§ˆ ê²€ì¦ |
| ë³‘ë ¬ ì‹¤í–‰ | LLM íŒë‹¨ | `.parallel()` ëª…ì‹œì  ì œì–´ |
| ì—ëŸ¬ ì²˜ë¦¬ | ì•”ë¬µì  | Step ë‹¨ìœ„ try/catch + ì¬ì‹œë„ |
| ê´€ì¸¡ì„± | ë¸”ë™ë°•ìŠ¤ | Stepë³„ input/output ì¶”ì  |

### ì „ì²´ Workflow íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Chat Workflow                               â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  â”‚ Step 1: Classify     â”‚  Agent(structured output)              â”‚
â”‚  â”‚ Intent & Route       â”‚  â†’ { type, targets[], queries{} }     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚             â”‚                                                    â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚       â”‚           .branch()                â”‚                     â”‚
â”‚       â”‚                                    â”‚                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ simple   â”‚  â”‚ single:  â”‚  â”‚single: â”‚  â”‚ multi-agent     â”‚   â”‚
â”‚  â”‚ (ì§ì ‘ì‘ë‹µ)â”‚  â”‚ ê°œë³„Agent â”‚  â”‚ê°œë³„Agentâ”‚  â”‚ Sub-Workflow    â”‚   â”‚
â”‚  â”‚          â”‚  â”‚ Step     â”‚  â”‚ Step   â”‚  â”‚                 â”‚   â”‚
â”‚  â”‚ Haiku    â”‚  â”‚          â”‚  â”‚        â”‚  â”‚  .parallel()    â”‚   â”‚
â”‚  â”‚          â”‚  â”‚ Atlassianâ”‚  â”‚Google  â”‚  â”‚  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚          â”‚  â”‚ or       â”‚  â”‚Search  â”‚  â”‚  â”‚ATLâ”‚GGLâ”‚DHBâ”‚  â”‚   â”‚
â”‚  â”‚          â”‚  â”‚ DataHub  â”‚  â”‚        â”‚  â”‚  â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â”‚      â”‚         â”‚   â”‚
â”‚       â”‚             â”‚            â”‚       â”‚  .then()        â”‚   â”‚
â”‚       â”‚             â”‚            â”‚       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚       â”‚             â”‚            â”‚       â”‚  â”‚Merge Step â”‚  â”‚   â”‚
â”‚       â”‚             â”‚            â”‚       â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚       â”‚             â”‚            â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚       â”‚             â”‚            â”‚                â”‚             â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                            â”‚                                     â”‚
â”‚                    .map() (ì¶œë ¥ ì •ê·œí™”)                            â”‚
â”‚                            â”‚                                     â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                  â”‚ Step Final:        â”‚                           â”‚
â”‚                  â”‚ Response Synthesis â”‚  Agent(Haiku/Sonnet)     â”‚
â”‚                  â”‚ ê²°ê³¼ í†µí•© + í¬ë§·íŒ…   â”‚                          â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ê° Step ìƒì„¸ ì„¤ëª…

#### Step 1: Intent Classification (ì˜ë„ ë¶„ë¥˜)

```typescript
const classifyStep = createStep({
  id: "classify-intent",
  inputSchema: z.object({ message: z.string() }),
  outputSchema: z.object({
    type: z.enum(["simple", "atlassian", "google-search", "datahub", "multi-agent"]),
    targets: z.array(z.enum(["atlassian", "google-search", "datahub"])),
    queries: z.record(z.string()),  // { "atlassian": "íšŒì˜ë¡ ê²€ìƒ‰í•´ì¤˜", ... }
  }),
  execute: async ({ inputData, mastra }) => {
    const classifier = mastra.getAgent("classifierAgent");
    // structured outputìœ¼ë¡œ ë¶„ë¥˜ ê²°ê³¼ë¥¼ ìŠ¤í‚¤ë§ˆì— ë§ê²Œ ë°˜í™˜
    const result = await classifier.generate(inputData.message, {
      output: classificationSchema,
    });
    return result.object;
  },
});
```

- **Haiku ëª¨ë¸** ì‚¬ìš© â†’ ë¼ìš°íŒ…ì— Sonnet ë‚­ë¹„ ë°©ì§€
- **structured output** â†’ ë¶„ë¥˜ ê²°ê³¼ê°€ Zod ìŠ¤í‚¤ë§ˆë¡œ ê²€ì¦ë¨
- í‚¤ì›Œë“œ + LLM ì¶”ë¡ ì˜ í•˜ì´ë¸Œë¦¬ë“œ ë¶„ë¥˜

#### Branch: ì¡°ê±´ ë¶„ê¸°

```typescript
.branch([
  [({ inputData }) => inputData.type === "simple",       directResponseStep],
  [({ inputData }) => inputData.type === "atlassian",    atlassianAgentStep],
  [({ inputData }) => inputData.type === "google-search", googleSearchAgentStep],
  [({ inputData }) => inputData.type === "datahub",      datahubAgentStep],
  [({ inputData }) => inputData.type === "multi-agent",  multiAgentWorkflow],
])
```

- **ê²°ì •ì  ë¶„ê¸°** - LLM ì¶”ë¡ ì´ ì•„ë‹Œ, ë¶„ë¥˜ ê²°ê³¼ ê¸°ë°˜
- ê° ë¶„ê¸°ì˜ ì…ì¶œë ¥ ìŠ¤í‚¤ë§ˆê°€ í†µì¼ë¨

#### Multi-Agent Sub-Workflow (ë³‘ë ¬ ì‹¤í–‰)

```typescript
const multiAgentWorkflow = createWorkflow({
  id: "multi-agent-execution",
  inputSchema: classifyOutputSchema,
  outputSchema: mergedResultSchema,
})
  .parallel([atlassianAgentStep, googleSearchAgentStep, datahubAgentStep])
  .then(mergeResultsStep)
  .commit();
```

- `.parallel()` â†’ í•„ìš”í•œ Agentë“¤ì´ **ë™ì‹œì—** ì‹¤í–‰
- ê° Agent Step ë‚´ë¶€ì—ì„œ `targets` ë°°ì—´ì„ í™•ì¸í•˜ì—¬, ìì‹ ì´ í¬í•¨ë˜ì§€ ì•Šìœ¼ë©´ ë¹ˆ ê²°ê³¼ ë°˜í™˜
- `mergeResultsStep`ì—ì„œ ìœ íš¨í•œ ê²°ê³¼ë§Œ í•„í„°ë§ í›„ í†µí•©

#### Final Step: Response Synthesis (ì‘ë‹µ í•©ì„±)

```typescript
const finalResponseStep = createStep({
  id: "synthesize-response",
  inputSchema: mergedResultSchema,
  outputSchema: z.object({ response: z.string() }),
  execute: async ({ inputData, mastra }) => {
    const responder = mastra.getAgent("finalResponderAgent");
    const result = await responder.generate(
      `ë‹¤ìŒ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‚¬ìš©ìì—ê²Œ ì‘ë‹µì„ ì‘ì„±í•˜ì„¸ìš”:\n${JSON.stringify(inputData)}`,
    );
    return { response: result.text };
  },
});
```

---

## 3. ë¹„êµ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

### Before: Agent Network

```
User Message
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Supervisor Agent      â”‚  â† Sonnet 4.5 (ë¹„ìš© ë†’ìŒ)
â”‚   (LLMì´ ëª¨ë“  ê²ƒ ê²°ì •)    â”‚
â”‚                         â”‚
â”‚   - ë¼ìš°íŒ… íŒë‹¨           â”‚  â† ë¹„ê²°ì •ì 
â”‚   - Worker í˜¸ì¶œ          â”‚  â† ìˆœì„œ/ë³‘ë ¬ LLM íŒë‹¨
â”‚   - ê²°ê³¼ í†µí•©            â”‚  â† ìì—°ì–´ ê¸°ë°˜
â”‚   - ìµœì¢… ì‘ë‹µ ìƒì„±        â”‚
â”‚                         â”‚
â”‚   ğŸ”„ ëª¨ë“  ì±…ì„ì´ í•˜ë‚˜ì—   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚    â”‚    â”‚
     â–¼    â–¼    â–¼
   ATL  GGL  DHB  (Workers, Haiku)
```

### After: Workflow

```
User Message
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Classify    â”‚  â† Haiku (ë¹„ìš© ì ˆê°)
â”‚ (structured    â”‚  â† Zod ìŠ¤í‚¤ë§ˆ ê²€ì¦
â”‚  output)       â”‚  â† ê²°ì •ì  ë¶„ë¥˜
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€ .branch() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚         (ê²°ì •ì  ë¶„ê¸°)                     â”‚
   â–¼              â–¼              â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Simpleâ”‚   â”‚Single    â”‚   â”‚Single   â”‚  â”‚Multi-Agent   â”‚
â”‚ì§ì ‘   â”‚   â”‚Agent     â”‚   â”‚Agent    â”‚  â”‚.parallel()   â”‚
â”‚ì‘ë‹µ   â”‚   â”‚(ATL/DHB) â”‚   â”‚(GGL)    â”‚  â”‚â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â” â”‚
â””â”€â”€â”¬â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚â”‚ATLâ”‚GGLâ”‚DHBâ”‚ â”‚
   â”‚            â”‚              â”‚       â”‚â””â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”˜ â”‚
   â”‚            â”‚              â”‚       â”‚  â””â”€â”€â”€â”¼â”€â”€â”€â”˜   â”‚
   â”‚            â”‚              â”‚       â”‚  Merge Step  â”‚
   â”‚            â”‚              â”‚       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                  .map() (ì •ê·œí™”)
                       â”‚
                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Final: Response â”‚  â† Agent (Haiku)
              â”‚ Synthesis       â”‚  â† ê²°ê³¼ í†µí•© ì „ìš©
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
                  User Response
```

---

## 4. ì „í™˜ìœ¼ë¡œ ì–»ëŠ” ì´ì  ìš”ì•½

| í•­ëª© | Agent Network | Workflow | ê°œì„ ë„ |
|------|-------------|----------|--------|
| **ë¼ìš°íŒ… ì¼ê´€ì„±** | LLM ì¶”ë¡  (ë¹„ê²°ì •ì ) | êµ¬ì¡°í™”ëœ ë¶„ë¥˜ + branch (ê²°ì •ì ) | â¬†â¬†â¬† |
| **ë°ì´í„° ì•ˆì „ì„±** | ìì—°ì–´ ì „ë‹¬ | Zod ìŠ¤í‚¤ë§ˆ ê²€ì¦ | â¬†â¬†â¬† |
| **ë³‘ë ¬ ì‹¤í–‰** | LLM íŒë‹¨ | `.parallel()` ëª…ì‹œì  ì œì–´ | â¬†â¬† |
| **ì—ëŸ¬ ì²˜ë¦¬** | ì•”ë¬µì  (LLMì´ í•´ì„) | Step ë‹¨ìœ„ ì‹¤íŒ¨/ì¬ì‹œë„ | â¬†â¬†â¬† |
| **ë¹„ìš©** | Sonnet 4.5 (ë¼ìš°íŒ…) | Haiku (ë¶„ë¥˜) + Haiku (ì‹¤í–‰) | â¬†â¬† |
| **ê´€ì¸¡ì„±** | ë¸”ë™ë°•ìŠ¤ | Stepë³„ input/output ë¡œê¹… | â¬†â¬†â¬† |
| **í…ŒìŠ¤íŠ¸ ìš©ì´ì„±** | ì „ì²´ í†µí•© í…ŒìŠ¤íŠ¸ë§Œ ê°€ëŠ¥ | Step ë‹¨ìœ„ ìœ ë‹› í…ŒìŠ¤íŠ¸ | â¬†â¬†â¬† |
| **í™•ì¥ì„±** | instructions ìˆ˜ì • | Step/Branch ì¶”ê°€ | â¬†â¬† |
| **Suspend/Resume** | ë¶ˆê°€ | ë‚´ì¥ ì§€ì› (Human-in-the-loop) | â¬†â¬† |
| **Time Travel** | ë¶ˆê°€ | íŠ¹ì • Stepë¶€í„° ì¬ì‹¤í–‰ ê°€ëŠ¥ | â¬†â¬† |

---

## 5. ì¶”ê°€ ê³ ë ¤ì‚¬í•­

### Memory í†µí•©

í˜„ì¬ Supervisor Agentì— ìˆëŠ” Memory(Working Memory í¬í•¨)ëŠ” Workflowì˜ **State** ë˜ëŠ” Step ë‚´ì—ì„œ Agentë¥¼ í˜¸ì¶œí•  ë•Œ `memory` ì˜µì…˜ìœ¼ë¡œ ëŒ€ì²´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### MCP ë„êµ¬ ì£¼ì…

Worker Agentì˜ íŒ©í† ë¦¬ íŒ¨í„´ì€ ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ë˜, Workflow Step ë‚´ì—ì„œ `mastra.getAgent()`ë¡œ Agentë¥¼ ê°€ì ¸ì™€ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.

### ìŠ¤íŠ¸ë¦¬ë°

Workflowì˜ `run.stream()`ì€ ê° Stepì˜ ì§„í–‰ ìƒí™©ì„ ì´ë²¤íŠ¸ë¡œ ë°©ì¶œí•˜ë¯€ë¡œ, í˜„ì¬ì˜ `networkRoute` ìŠ¤íŠ¸ë¦¬ë°ì„ ëŒ€ì²´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## 6. ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ëµ

### Phase 1: Workflow ê¸°ë³¸ êµ¬ì¡° êµ¬ì¶•

1. `src/mastra/workflows/` ë””ë ‰í† ë¦¬ ìƒì„±
2. Intent Classification Step êµ¬í˜„ (Classifier Agent + structured output)
3. ê¸°ë³¸ `.then()` ì²´ì¸ìœ¼ë¡œ ë‹¨ì¼ Agent ì‹¤í–‰ ê²€ì¦

### Phase 2: ë¶„ê¸° ë° ë³‘ë ¬ ì‹¤í–‰

1. `.branch()` ì¡°ê±´ ë¶„ê¸° êµ¬í˜„
2. Multi-Agent Sub-Workflow (`.parallel()`) êµ¬í˜„
3. Merge Step êµ¬í˜„

### Phase 3: Final Response ë° í†µí•©

1. Response Synthesis Step êµ¬í˜„
2. Memory/State í†µí•©
3. ê¸°ì¡´ `/chat` ë¼ìš°íŠ¸ë¥¼ Workflow ê¸°ë°˜ìœ¼ë¡œ êµì²´

### Phase 4: ì •ë¦¬ ë° ìµœì í™”

1. ê¸°ì¡´ Supervisor Agent ì½”ë“œ ì œê±°
2. ì—ëŸ¬ ì²˜ë¦¬ ë° ì¬ì‹œë„ ë¡œì§ ì¶”ê°€
3. Observability ì„¤ì • í™•ì¸
4. ìŠ¤íŠ¸ë¦¬ë° í†µí•© í…ŒìŠ¤íŠ¸
